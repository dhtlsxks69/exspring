<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="kr.ac.hit.myapp.bbs.BbsDao">
      
      <resultMap type="BbsVo" id="bbsMap">
          <id column="bbs_no" property="bbsNo" />
          <id column="bbs_title" property="bbsTitle" />
          <id column="bbs_content" property="bbsContent" />
          <id column="bbs_writer" property="bbsWriter" />
          <id column="bbs_reg_date" property="bbsRegDate" />
          <id column="bbs_count" property="bbsCount" />
		  <!-- 조인 결과 다수의 객체(리스트)로 담아야 하는 컬럼값들은 collection 사용 -->
          <collection property="attList" ofType="AttachVo">
              <id column="att_no" property="attNo" />
              <id column="att_org_name" property="attOrgName" />
              <id column="att_new_name" property="attNewName" />
              <id column="att_bbs_no" property="attBbsNo" />
          </collection>
      </resultMap>
      
<!-- useGeneratedKeys="true" 를 사용하여 -->
<!-- (AUTO_INCREMENT에 의해서) 자동생성된 PK(기본키) 값을 -->
<!-- 파라미터 객체의 keyProperty에 지정된 속성(변수)에 저장 가능 -->
      <insert id="insert" parameterType="BbsVo" useGeneratedKeys="true" keyProperty="bbsNo">
          INSERT
          INTO bbs(bbs_title, bbs_content, bbs_writer)
          VALUES (#{bbsTitle}, #{bbsContent}, #{bbsWriter})
      </insert>
      
      <select id="selectList" resultType="BbsVo">
          SELECT bbs_no, bbs_title, bbs_writer, bbs_reg_date, bbs_count
          FROM bbs
      </select>
      
      <select id="select" parameterType="int" resultMap="bbsMap" >
          SELECT bbs_no, bbs_title, bbs_content, bbs_writer, bbs_reg_date, bbs_count, att_no, att_org_name, att_new_name, att_bbs_no
		  FROM bbs
		  LEFT OUTER JOIN attach
		  ON bbs_no = att_bbs_no
		  WHERE bbs_no = #{bbs_no}
      </select>
      
      <update id="update" parameterType="BbsVo">
          UPDATE bbs
          SET bbs_title = #{bbsTitle}, bbs_content = #{bbsContent}
          WHERE bbs_no = #{bbsNo} AND bbs_writer = #{bbsWriter}
      </update>
      
      <delete id="delete" parameterType="BbsVo">
          DELETE
          FROM bbs
          WHERE bbs_no = #{bbsNo} AND bbs_writer = #{bbsWriter}
      </delete>
      
  </mapper>